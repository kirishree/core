db.conn_all.aggregate([ { "$match": { "start_time": { "$gt":___START_TIME___, "$lt": ___END_TIME___ } } }, { "$project": { "ip_dst_saddr": "$ip_dst_saddr", "start_time": "$start_time", "_interval": { "$toInt": { "$divide": [ { "$toLong": "$start_time" }, ___INTERVAL___ ] } } } }, { "$group": { "_id": { "_interval": "$_interval" }, "start_time": { "$max": "$start_time" }, "label": { "$addToSet": "$ip_dst_saddr" }, "total": { "$sum": 1 } } }, { "$sort": { "start_time": -1 } }, { "$limit": 10 } ])