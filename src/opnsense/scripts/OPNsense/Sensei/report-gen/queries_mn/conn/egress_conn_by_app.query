db.conn_all.aggregate([ { "$match": { "start_time": { "$gt":___START_TIME___, "$lt": ___END_TIME___ }, "src_dir": "EGRESS" } }, { "$project": { "label": "$app_name", "total": "___SUM_FIELD___", "_interval": {  "$toInt": {"$divide": [ { "$toLong": "$start_time" }, ___INTERVAL___ ]} } } }, { "$group": { "_id": { "label": "$label", "_interval": "$_interval" }, "total": { "$sum": 1 } } }, { "$sort": { "total": -1 } }, { "$limit": 10 } ])