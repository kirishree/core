[ { "$match": { "start_time": { "$gt":__GTE__, "$lt": __LTE__ } } }, { "$project": { "label": "$server_name", "total":"___SUM_FIELD___","start_time": "$start_time", "_interval": { "$floor": { "$divide": [ { "$toLong": "$start_time" }, __INTERVAL__ ] } } } }, { "$group": { "_id": { "label": "$label", "_interval": "$_interval" },"start_time": {"$max":"$start_time"}, "total": { "$sum": "$total" } } }, { "$sort": { "total": -1 } }]